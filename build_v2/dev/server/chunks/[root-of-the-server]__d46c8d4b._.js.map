{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dhanush/agronova/lib/store.ts"],"sourcesContent":["import fs from 'fs/promises';\r\nimport path from 'path';\r\n\r\nconst DATA_FILE = path.join(process.cwd(), 'data', 'products.json');\r\n\r\n// Helper to ensure data directory exists\r\nasync function ensureDataDir() {\r\n    const dir = path.dirname(DATA_FILE);\r\n    try {\r\n        await fs.access(dir);\r\n    } catch {\r\n        await fs.mkdir(dir, { recursive: true });\r\n    }\r\n}\r\n\r\nexport async function getProducts() {\r\n    await ensureDataDir();\r\n    try {\r\n        const data = await fs.readFile(DATA_FILE, 'utf-8');\r\n        return JSON.parse(data);\r\n    } catch (error) {\r\n        return [];\r\n    }\r\n}\r\n\r\n// Saves a single product by appending (legacy support) OR overwrites if array passed\r\nexport async function saveProduct(productOrProducts: any) {\r\n    await ensureDataDir();\r\n    \r\n    if (Array.isArray(productOrProducts)) {\r\n        // Overwrite entire file (for deletions/updates)\r\n        await fs.writeFile(DATA_FILE, JSON.stringify(productOrProducts, null, 2));\r\n        return productOrProducts;\r\n    } else {\r\n        // Append single product\r\n        const products = await getProducts();\r\n        products.push(productOrProducts);\r\n        await fs.writeFile(DATA_FILE, JSON.stringify(products, null, 2));\r\n        return productOrProducts;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAEnD,yCAAyC;AACzC,eAAe;IACX,MAAM,MAAM,4GAAI,CAAC,OAAO,CAAC;IACzB,IAAI;QACA,MAAM,gIAAE,CAAC,MAAM,CAAC;IACpB,EAAE,OAAM;QACJ,MAAM,gIAAE,CAAC,KAAK,CAAC,KAAK;YAAE,WAAW;QAAK;IAC1C;AACJ;AAEO,eAAe;IAClB,MAAM;IACN,IAAI;QACA,MAAM,OAAO,MAAM,gIAAE,CAAC,QAAQ,CAAC,WAAW;QAC1C,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,OAAO;QACZ,OAAO,EAAE;IACb;AACJ;AAGO,eAAe,YAAY,iBAAsB;IACpD,MAAM;IAEN,IAAI,MAAM,OAAO,CAAC,oBAAoB;QAClC,gDAAgD;QAChD,MAAM,gIAAE,CAAC,SAAS,CAAC,WAAW,KAAK,SAAS,CAAC,mBAAmB,MAAM;QACtE,OAAO;IACX,OAAO;QACH,wBAAwB;QACxB,MAAM,WAAW,MAAM;QACvB,SAAS,IAAI,CAAC;QACd,MAAM,gIAAE,CAAC,SAAS,CAAC,WAAW,KAAK,SAAS,CAAC,UAAU,MAAM;QAC7D,OAAO;IACX;AACJ"}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dhanush/agronova/app/api/store/products/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { getProducts, saveProduct } from '@/lib/store';\r\n\r\nexport async function GET() {\r\n    const products = await getProducts();\r\n    return NextResponse.json(products);\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const body = await request.json();\r\n        const { name, category, price, image, seller, sellerVpa, description, stock, unit } = body;\r\n\r\n        if (!name || !price || !seller) {\r\n             return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 });\r\n        }\r\n\r\n        const newProduct = await saveProduct({\r\n            id: Date.now(),\r\n            name,\r\n            category,\r\n            price: Number(price),\r\n            image,\r\n            seller,\r\n            sellerVpa,\r\n            description,\r\n            stock: Number(stock),\r\n            unit: unit || \"units\"\r\n        });\r\n\r\n        return NextResponse.json(newProduct);\r\n    } catch (e) {\r\n        console.error(\"Failed to add product\", e);\r\n        return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function DELETE(request: Request) {\r\n    try {\r\n        const { searchParams } = new URL(request.url);\r\n        const id = searchParams.get('id');\r\n\r\n        if (!id) {\r\n            return NextResponse.json({ error: \"Product ID is required\" }, { status: 400 });\r\n        }\r\n\r\n        const products = await getProducts();\r\n        const filteredProducts = products.filter((p: any) => String(p.id) !== id);\r\n        \r\n        if (products.length === filteredProducts.length) {\r\n            return NextResponse.json({ error: \"Product not found\" }, { status: 404 });\r\n        }\r\n\r\n        await saveProduct(filteredProducts);\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (e) {\r\n        console.error(\"Failed to delete product\", e);\r\n        return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,eAAe;IAClB,MAAM,WAAW,MAAM,IAAA,yIAAW;IAClC,OAAO,4JAAY,CAAC,IAAI,CAAC;AAC7B;AAEO,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,WAAW,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG;QAEtF,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ;YAC3B,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAClF;QAEA,MAAM,aAAa,MAAM,IAAA,yIAAW,EAAC;YACjC,IAAI,KAAK,GAAG;YACZ;YACA;YACA,OAAO,OAAO;YACd;YACA;YACA;YACA;YACA,OAAO,OAAO;YACd,MAAM,QAAQ;QAClB;QAEA,OAAO,4JAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ;AAEO,eAAe,OAAO,OAAgB;IACzC,IAAI;QACA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,KAAK,aAAa,GAAG,CAAC;QAE5B,IAAI,CAAC,IAAI;YACL,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,WAAW,MAAM,IAAA,yIAAW;QAClC,MAAM,mBAAmB,SAAS,MAAM,CAAC,CAAC,IAAW,OAAO,EAAE,EAAE,MAAM;QAEtE,IAAI,SAAS,MAAM,KAAK,iBAAiB,MAAM,EAAE;YAC7C,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,IAAA,yIAAW,EAAC;QAElB,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC7C,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ"}}]
}