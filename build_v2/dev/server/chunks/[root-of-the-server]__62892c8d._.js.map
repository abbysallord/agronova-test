{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dhanush/agronova/app/api/reports/generate/route.ts"],"sourcesContent":["import { Mistral } from \"@mistralai/mistralai\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n    const { crops, farmSize, location } = body;\r\n\r\n    if (!crops || crops.length === 0) {\r\n      return NextResponse.json({ error: \"No crops provided\" }, { status: 400 });\r\n    }\r\n\r\n    if (!process.env.MISTRAL_API_KEY) {\r\n        return NextResponse.json({ error: \"MISTRAL_API_KEY not configured\" }, { status: 500 });\r\n    }\r\n\r\n    const client = new Mistral({\r\n      apiKey: process.env.MISTRAL_API_KEY,\r\n    });\r\n\r\n    const prompt = `Generate a detailed Farm Report for a farmer in ${location || \"India\"} with ${farmSize || \"2\"} acres of land, growing: ${crops.join(\", \")}.\r\n    \r\n    Return ONLY a valid JSON object with the following structure (do NOT include markdown formatting):\r\n    {\r\n      \"performance\": \"General assessment of how these crops perform in this region/season. 2-3 sentences.\",\r\n      \"yield_forecast\": {\r\n          \"estimated_yield\": \"e.g. 4.5 Tons\",\r\n          \"details\": \"Explanation based on acreage.\"\r\n      },\r\n      \"financials\": {\r\n          \"revenue\": \"e.g. ₹2,50,000\",\r\n          \"expenses\": \"e.g. ₹80,000\",\r\n          \"profit\": \"e.g. ₹1,70,000\",\r\n          \"notes\": \"Brief explanation of costs and market prices.\"\r\n      },\r\n      \"tips\": [\r\n          \"Actionable tip 1\",\r\n          \"Actionable tip 2\",\r\n          \"Actionable tip 3\"\r\n      ],\r\n      \"breakthroughs\": [\r\n          {\r\n              \"title\": \"Title of new tech/method\",\r\n              \"description\": \"Description of how it helps.\"\r\n          },\r\n          {\r\n              \"title\": \"Another breakthrough\",\r\n              \"description\": \"Description.\"\r\n          }\r\n      ]\r\n    }\r\n    IMPORTANT: Provide realistic, agricultural data. Be encouraging but factual.`;\r\n\r\n    const response = await client.chat.complete({\r\n      model: \"mistral-small-latest\",\r\n      messages: [\r\n        {\r\n          role: \"user\",\r\n          content: prompt,\r\n        },\r\n      ],\r\n      responseFormat: { type: \"json_object\" },\r\n    });\r\n\r\n    const content = response.choices?.[0]?.message?.content;\r\n\r\n    if (!content) {\r\n        throw new Error(\"No content received from AI\");\r\n    }\r\n\r\n    try {\r\n        const cleanText = (content as string).replace(/```json/g, '').replace(/```/g, '').trim();\r\n        const jsonResponse = JSON.parse(cleanText);\r\n        return NextResponse.json(jsonResponse);\r\n    } catch (e) {\r\n        console.error(\"JSON Parse Error:\", content);\r\n        return NextResponse.json({ error: \"Failed to parse AI response\" }, { status: 500 });\r\n    }\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Report Generation Error:\", error);\r\n    return NextResponse.json({ \r\n        error: error.message || \"Internal Server Error\"\r\n    }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG;QAEtC,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,GAAG;YAChC,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,eAAe,EAAE;YAC9B,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiC,GAAG;gBAAE,QAAQ;YAAI;QACxF;QAEA,MAAM,SAAS,IAAI,0KAAO,CAAC;YACzB,QAAQ,QAAQ,GAAG,CAAC,eAAe;QACrC;QAEA,MAAM,SAAS,CAAC,gDAAgD,EAAE,YAAY,QAAQ,MAAM,EAAE,YAAY,IAAI,yBAAyB,EAAE,MAAM,IAAI,CAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gFA+B9E,CAAC;QAE7E,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,QAAQ,CAAC;YAC1C,OAAO;YACP,UAAU;gBACR;oBACE,MAAM;oBACN,SAAS;gBACX;aACD;YACD,gBAAgB;gBAAE,MAAM;YAAc;QACxC;QAEA,MAAM,UAAU,SAAS,OAAO,EAAE,CAAC,EAAE,EAAE,SAAS;QAEhD,IAAI,CAAC,SAAS;YACV,MAAM,IAAI,MAAM;QACpB;QAEA,IAAI;YACA,MAAM,YAAY,AAAC,QAAmB,OAAO,CAAC,YAAY,IAAI,OAAO,CAAC,QAAQ,IAAI,IAAI;YACtF,MAAM,eAAe,KAAK,KAAK,CAAC;YAChC,OAAO,4JAAY,CAAC,IAAI,CAAC;QAC7B,EAAE,OAAO,GAAG;YACR,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACrF;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,4JAAY,CAAC,IAAI,CAAC;YACrB,OAAO,MAAM,OAAO,IAAI;QAC5B,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}