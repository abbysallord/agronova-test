{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dhanush/agronova/lib/otp.ts"],"sourcesContent":["import crypto from \"crypto\";\r\n\r\nconst SECRET = process.env.OTP_SECRET || \"fallback-secret-key-change-me\";\r\n\r\nexport const generateOtp = () => {\r\n  return Math.floor(100000 + Math.random() * 900000).toString();\r\n};\r\n\r\nexport const createOtpHash = (email: string, code: string, expiry: number) => {\r\n  const data = `${email}.${code}.${expiry}`;\r\n  return crypto.createHmac(\"sha256\", SECRET).update(data).digest(\"hex\");\r\n};\r\n\r\nexport const verifyOtpHash = (email: string, code: string, expiry: number, hash: string) => {\r\n  const newHash = createOtpHash(email, code, expiry);\r\n  return newHash === hash;\r\n};\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;AAElC,MAAM,cAAc;IACzB,OAAO,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;AAC7D;AAEO,MAAM,gBAAgB,CAAC,OAAe,MAAc;IACzD,MAAM,OAAO,GAAG,MAAM,CAAC,EAAE,KAAK,CAAC,EAAE,QAAQ;IACzC,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,QAAQ,MAAM,CAAC,MAAM,MAAM,CAAC;AACjE;AAEO,MAAM,gBAAgB,CAAC,OAAe,MAAc,QAAgB;IACzE,MAAM,UAAU,cAAc,OAAO,MAAM;IAC3C,OAAO,YAAY;AACrB"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dhanush/agronova/app/api/auth/otp/verify/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { verifyOtpHash } from \"@/lib/otp\";\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const { email, otp, hash, expiry } = await req.json();\r\n\r\n    if (!email || !otp || !hash || !expiry) {\r\n        return NextResponse.json({ error: \"Missing verification data\" }, { status: 400 });\r\n    }\r\n\r\n    // 1. Check Expiry\r\n    if (Date.now() > expiry) {\r\n        return NextResponse.json({ error: \"OTP has expired. Please request a new one.\" }, { status: 400 });\r\n    }\r\n\r\n    // 2. Verify Hash\r\n    const isValid = verifyOtpHash(email, otp, expiry, hash);\r\n\r\n    if (!isValid) {\r\n        return NextResponse.json({ error: \"Invalid OTP. Please check the code.\" }, { status: 400 });\r\n    }\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error: any) {\r\n    console.error(\"OTP Verify Error:\", error);\r\n    return NextResponse.json({ error: \"Verification failed\", details: error.message }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QAEnD,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,QAAQ;YACpC,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,kBAAkB;QAClB,IAAI,KAAK,GAAG,KAAK,QAAQ;YACrB,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6C,GAAG;gBAAE,QAAQ;YAAI;QACpG;QAEA,iBAAiB;QACjB,MAAM,UAAU,IAAA,yIAAa,EAAC,OAAO,KAAK,QAAQ;QAElD,IAAI,CAAC,SAAS;YACV,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsC,GAAG;gBAAE,QAAQ;YAAI;QAC7F;QAEA,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAuB,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnG;AACF"}}]
}