{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dhanush/agronova/lib/db.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DATA_DIR = 'c:/Users/Dhanush/agronova/data'; // path.join(process.cwd(), 'data');\r\nconst ORDERS_FILE = path.join(DATA_DIR, 'orders.json');\r\nconst USERS_FILE = path.join(DATA_DIR, 'users.json');\r\n\r\n// Ensure data directory exists\r\nif (!fs.existsSync(DATA_DIR)) {\r\n    fs.mkdirSync(DATA_DIR, { recursive: true });\r\n}\r\n\r\n// Types\r\nexport interface Order {\r\n    id: string;\r\n    buyerEmail: string;\r\n    sellerVpa: string; // The \"Seller\" ID in this context\r\n    amount: number;\r\n    items: any[];\r\n    status: 'PENDING_BUYER' | 'PENDING_SELLER' | 'VERIFIED' | 'FAILED' | 'DISPUTED';\r\n    createdAt: string;\r\n    tries: number;\r\n    buyerUpiIndex?: string; // Captured from Buyer Input\r\n    shippingAddress: string;\r\n}\r\n\r\nexport interface Strike {\r\n    id: string;\r\n    date: string;\r\n    reason: string;\r\n    orderId: string;\r\n    active: boolean; // If false, it was removed/forgiven\r\n}\r\n\r\nexport interface User {\r\n    email: string; // or UPI ID\r\n    name?: string;\r\n    role?: string;\r\n    strikes: Strike[];\r\n    status: 'CLEAR' | 'YELLOW' | 'RED' | 'BLACK';\r\n    followers?: string[];\r\n    following?: string[];\r\n}\r\n\r\n// Helpers\r\nfunction readJSON<T>(file: string, defaultValue: T): T {\r\n    if (!fs.existsSync(file)) return defaultValue;\r\n    try {\r\n        const data = fs.readFileSync(file, 'utf-8');\r\n        return JSON.parse(data);\r\n    } catch (e) {\r\n        return defaultValue;\r\n    }\r\n}\r\n\r\nfunction writeJSON(file: string, data: any) {\r\n    fs.writeFileSync(file, JSON.stringify(data, null, 2));\r\n}\r\n\r\n// --- Orders API ---\r\n\r\nexport const dbOrders = {\r\n    getAll: () => readJSON<Order[]>(ORDERS_FILE, []),\r\n    \r\n    getById: (id: string) => {\r\n        const orders = readJSON<Order[]>(ORDERS_FILE, []);\r\n        return orders.find(o => o.id === id);\r\n    },\r\n\r\n    create: (order: Order) => {\r\n        const orders = readJSON<Order[]>(ORDERS_FILE, []);\r\n        orders.push(order);\r\n        writeJSON(ORDERS_FILE, orders);\r\n        return order;\r\n    },\r\n\r\n    update: (id: string, updates: Partial<Order>) => {\r\n        const orders = readJSON<Order[]>(ORDERS_FILE, []);\r\n        const index = orders.findIndex(o => o.id === id);\r\n        if (index === -1) return null;\r\n        \r\n        orders[index] = { ...orders[index], ...updates };\r\n        writeJSON(ORDERS_FILE, orders);\r\n        return orders[index];\r\n    }\r\n};\r\n\r\n// --- Users API (Malpractice) ---\r\n\r\nexport const dbUsers = {\r\n    getAll: () => readJSON<User[]>(USERS_FILE, []),\r\n\r\n    get: (email: string) => {\r\n        const users = readJSON<User[]>(USERS_FILE, []);\r\n        return users.find(u => u.email === email);\r\n    },\r\n\r\n    // Add or Get User (Safe Create)\r\n    ensure: (userData: Partial<User> & { email: string }) => {\r\n        const users = readJSON<User[]>(USERS_FILE, []);\r\n        let user = users.find(u => u.email === userData.email);\r\n        if (!user) {\r\n            user = { \r\n                email: userData.email, \r\n                strikes: [], \r\n                status: 'CLEAR',\r\n                name: userData.name || userData.email.split('@')[0], \r\n                role: userData.role || 'Farmer',\r\n                followers: userData.followers || [],\r\n                following: userData.following || []\r\n            } as any; // Cast to avoid strict type issues with extended fields if User interface isn't fully updated yet (I updated it previously but name/role might be missing in Interface?)\r\n            // Actually I need to add name/role to User Interface too? yes.\r\n            users.push(user);\r\n            writeJSON(USERS_FILE, users);\r\n        }\r\n        return user;\r\n    },\r\n\r\n    addStrike: (email: string, reason: string, orderId: string) => {\r\n        const users = readJSON<User[]>(USERS_FILE, []);\r\n        const index = users.findIndex(u => u.email === email);\r\n        \r\n        if (index === -1) {\r\n            // Create user if not exists\r\n            const newUser: User = { \r\n                email, \r\n                strikes: [{ id: Date.now().toString(), date: new Date().toISOString(), reason, orderId, active: true }], \r\n                status: 'CLEAR' // Will update below\r\n            };\r\n            users.push(newUser);\r\n            // Recalculate status\r\n            updateUserStatus(newUser);\r\n            writeJSON(USERS_FILE, users);\r\n            return newUser;\r\n        }\r\n\r\n        const user = users[index];\r\n        user.strikes.push({ id: Date.now().toString(), date: new Date().toISOString(), reason, orderId, active: true });\r\n        updateUserStatus(user);\r\n        writeJSON(USERS_FILE, users);\r\n        return user;\r\n    },\r\n\r\n    removeStrike: (email: string, strikeId: string) => {\r\n         const users = readJSON<User[]>(USERS_FILE, []);\r\n         const user = users.find(u => u.email === email);\r\n         if (!user) return null;\r\n\r\n         const strike = user.strikes.find(s => s.id === strikeId);\r\n         if (strike) {\r\n             strike.active = false; // Soft delete\r\n             updateUserStatus(user);\r\n             writeJSON(USERS_FILE, users);\r\n         }\r\n         return user;\r\n    }\r\n};\r\n\r\nfunction updateUserStatus(user: User) {\r\n    const activeStrikes = user.strikes.filter(s => s.active).length;\r\n    if (activeStrikes === 0) user.status = 'CLEAR';\r\n    else if (activeStrikes === 1) user.status = 'YELLOW';\r\n    else if (activeStrikes === 2) user.status = 'RED';\r\n    else if (activeStrikes >= 3) user.status = 'BLACK';\r\n}\r\n\r\n// --- Community API ---\r\n\r\n// --- Community API ---\r\n\r\nconst POSTS_FILE = path.join(DATA_DIR, 'posts.json');\r\n\r\nexport interface Comment {\r\n    id: string;\r\n    userEmail: string;\r\n    userName: string;\r\n    text: string;\r\n    date: string;\r\n}\r\n\r\nexport interface Post {\r\n    id: string;\r\n    userEmail: string; // Author\r\n    userName: string;\r\n    userRole: string; // Farmer/Admin\r\n    content: string;\r\n    image?: string; // Base64 or URL\r\n    likes: string[]; // List of user emails who liked\r\n    comments: Comment[];\r\n    date: string;\r\n}\r\n\r\nexport const dbPosts = {\r\n    getAll: () => {\r\n        const posts = readJSON<Post[]>(POSTS_FILE, []);\r\n        return posts.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n    },\r\n\r\n    create: (post: Omit<Post, 'id' | 'likes' | 'comments' | 'date'>) => {\r\n        const posts = readJSON<Post[]>(POSTS_FILE, []);\r\n        console.log(`[DB] Creating post. Current count: ${posts.length}`);\r\n        const newPost: Post = {\r\n            ...post,\r\n            id: Date.now().toString(),\r\n            likes: [],\r\n            comments: [],\r\n            date: new Date().toISOString()\r\n        };\r\n        posts.push(newPost);\r\n        writeJSON(POSTS_FILE, posts);\r\n        console.log(`[DB] Post created. New count: ${posts.length}`);\r\n        return newPost;\r\n    },\r\n\r\n    toggleLike: (postId: string, userEmail: string) => {\r\n        const posts = readJSON<Post[]>(POSTS_FILE, []);\r\n        const post = posts.find(p => p.id === postId);\r\n        if (!post) return null;\r\n\r\n        const idx = post.likes.indexOf(userEmail);\r\n        if (idx === -1) {\r\n            post.likes.push(userEmail);\r\n        } else {\r\n            post.likes.splice(idx, 1);\r\n        }\r\n        writeJSON(POSTS_FILE, posts);\r\n        return post;\r\n    },\r\n\r\n    addComment: (postId: string, comment: Omit<Comment, 'id' | 'date'>) => {\r\n        const posts = readJSON<Post[]>(POSTS_FILE, []);\r\n        const post = posts.find(p => p.id === postId);\r\n        if (!post) return null;\r\n\r\n        const newComment: Comment = {\r\n            ...comment,\r\n            id: Date.now().toString(),\r\n            date: new Date().toISOString()\r\n        };\r\n        post.comments.push(newComment);\r\n        writeJSON(POSTS_FILE, posts);\r\n        return newComment;\r\n    },\r\n\r\n    deleteComment: (postId: string, commentId: string, userEmail: string) => {\r\n        const posts = readJSON<Post[]>(POSTS_FILE, []);\r\n        const post = posts.find(p => p.id === postId);\r\n        if (!post) return null;\r\n\r\n        const commentIdx = post.comments.findIndex(c => c.id === commentId);\r\n        if (commentIdx === -1) return null;\r\n\r\n        const comment = post.comments[commentIdx];\r\n        const isCommentOwner = comment.userEmail.toLowerCase().trim() === userEmail.toLowerCase().trim();\r\n        const isPostOwner = post.userEmail.toLowerCase().trim() === userEmail.toLowerCase().trim();\r\n\r\n        if (!isCommentOwner && !isPostOwner) return null; // Unauthorized\r\n\r\n        post.comments.splice(commentIdx, 1);\r\n        writeJSON(POSTS_FILE, posts);\r\n        return post;\r\n    },\r\n\r\n    delete: (postId: string, userEmail: string) => {\r\n        const safeEmail = userEmail?.toLowerCase().trim();\r\n        console.log(`[DB] Request Delete Post ${postId} by ${safeEmail}`);\r\n        \r\n        let posts = readJSON<Post[]>(POSTS_FILE, []);\r\n        const post = posts.find(p => p.id === postId);\r\n        \r\n        if (!post) {\r\n            console.log(`[DB] Post ${postId} not found.`);\r\n            return false;\r\n        }\r\n\r\n        const postOwner = post.userEmail?.toLowerCase().trim();\r\n        console.log(`[DB] Found Post. Owner: ${postOwner}, Requestor: ${safeEmail}`);\r\n\r\n        if (postOwner !== safeEmail) {\r\n            console.log(`[DB] Unauthorized delete attempt.`);\r\n            return false;\r\n        }\r\n        \r\n        posts = posts.filter(p => p.id !== postId);\r\n        console.log(`[DB] Writing ${posts.length} posts to file.`);\r\n        writeJSON(POSTS_FILE, posts);\r\n        return true;\r\n    },\r\n\r\n    edit: (postId: string, userEmail: string, newContent: string) => {\r\n        const posts = readJSON<Post[]>(POSTS_FILE, []);\r\n        const post = posts.find(p => p.id === postId);\r\n        if (!post || post.userEmail.toLowerCase().trim() !== userEmail.toLowerCase().trim()) return null;\r\n\r\n        post.content = newContent;\r\n        writeJSON(POSTS_FILE, posts);\r\n        return post;\r\n    }\r\n};\r\n\r\n// --- Social & Messages API ---\r\n\r\nconst MESSAGES_FILE = path.join(DATA_DIR, 'messages.json');\r\n\r\nexport interface Message {\r\n    id: string;\r\n    sender: string;\r\n    receiver: string;\r\n    content: string;\r\n    timestamp: string;\r\n    read: boolean;\r\n    reactions?: Record<string, string>;\r\n    replyToId?: string;\r\n    edited?: boolean;\r\n}\r\n\r\nexport const dbSocial = {\r\n    toggleFollow: (userEmail: string, targetEmail: string) => {\r\n        const users = readJSON<User[]>(USERS_FILE, []);\r\n        const user = users.find(u => u.email === userEmail);\r\n        const target = users.find(u => u.email === targetEmail);\r\n        \r\n        if (!user || !target) return false;\r\n\r\n        if (!user.following) user.following = [];\r\n        if (!target.followers) target.followers = [];\r\n\r\n        const idx = user.following.indexOf(targetEmail);\r\n        if (idx === -1) {\r\n            user.following.push(targetEmail);\r\n            target.followers.push(userEmail);\r\n        } else {\r\n            user.following.splice(idx, 1);\r\n            const tIdx = target.followers.indexOf(userEmail);\r\n            if (tIdx !== -1) target.followers.splice(tIdx, 1);\r\n        }\r\n\r\n        writeJSON(USERS_FILE, users);\r\n        return true;\r\n    },\r\n\r\n    getMessages: (userEmail: string) => {\r\n        let msgs = readJSON<Message[]>(MESSAGES_FILE, []);\r\n        \r\n        // Auto-Delete > 24h\r\n        const now = Date.now();\r\n        const ONE_DAY = 24 * 60 * 60 * 1000;\r\n        // const ONE_DAY = 2 * 60 * 1000; // Debug: 2 mins\r\n        const initialLen = msgs.length;\r\n        msgs = msgs.filter(m => (now - new Date(m.timestamp).getTime()) < ONE_DAY);\r\n        if (msgs.length !== initialLen) writeJSON(MESSAGES_FILE, msgs);\r\n\r\n        return msgs.filter(m => m.sender === userEmail || m.receiver === userEmail)\r\n                   .sort((a,b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\r\n    },\r\n\r\n    sendMessage: (sender: string, receiver: string, content: string, replyToId?: string) => {\r\n        const msgs = readJSON<Message[]>(MESSAGES_FILE, []);\r\n        const newMsg: Message = {\r\n            id: Date.now().toString(),\r\n            sender,\r\n            receiver,\r\n            content,\r\n            timestamp: new Date().toISOString(),\r\n            read: false,\r\n            reactions: {},\r\n            replyToId\r\n        };\r\n        msgs.push(newMsg);\r\n        writeJSON(MESSAGES_FILE, msgs);\r\n        return newMsg;\r\n    },\r\n\r\n    deleteMessage: (msgId: string, userEmail: string) => {\r\n        let msgs = readJSON<Message[]>(MESSAGES_FILE, []);\r\n        const msg = msgs.find(m => m.id === msgId);\r\n        // Allow sender or receiver to delete? Usually only sender deletes for everyone.\r\n        if (!msg || msg.sender !== userEmail) return false;\r\n\r\n        msgs = msgs.filter(m => m.id !== msgId);\r\n        writeJSON(MESSAGES_FILE, msgs);\r\n        return true;\r\n    },\r\n\r\n    editMessage: (msgId: string, userEmail: string, newContent: string) => {\r\n        const msgs = readJSON<Message[]>(MESSAGES_FILE, []);\r\n        const msg = msgs.find(m => m.id === msgId);\r\n        if (!msg || msg.sender !== userEmail) return null;\r\n\r\n        msg.content = newContent;\r\n        msg.edited = true;\r\n        writeJSON(MESSAGES_FILE, msgs);\r\n        return msg;\r\n    },\r\n\r\n    reactMessage: (msgId: string, userEmail: string, emoji: string) => {\r\n        const msgs = readJSON<Message[]>(MESSAGES_FILE, []);\r\n        const msg = msgs.find(m => m.id === msgId);\r\n        if (!msg) return null;\r\n\r\n        if (!msg.reactions) msg.reactions = {};\r\n        if (msg.reactions[userEmail] === emoji) delete msg.reactions[userEmail];\r\n        else msg.reactions[userEmail] = emoji;\r\n        \r\n        writeJSON(MESSAGES_FILE, msgs);\r\n        return msg;\r\n    }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 374, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dhanush/agronova/app/api/messages/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { dbSocial } from \"@/lib/db\";\r\n\r\nexport async function DELETE(req: Request, props: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const params = await props.params;\r\n        const { id } = params;\r\n        const { searchParams } = new URL(req.url);\r\n        const userEmail = searchParams.get('userEmail');\r\n\r\n        if (!userEmail) return NextResponse.json({ error: \"Missing user\" }, { status: 400 });\r\n\r\n        const success = dbSocial.deleteMessage(id, userEmail);\r\n        if (!success) return NextResponse.json({ error: \"Unauthorized or Not Found\" }, { status: 403 });\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (e: any) {\r\n        return NextResponse.json({ error: e.message }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function PATCH(req: Request, props: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const params = await props.params;\r\n        const { id } = params;\r\n        const body = await req.json();\r\n        const { userEmail, content, reaction } = body;\r\n\r\n        let result;\r\n        if (reaction) {\r\n            result = dbSocial.reactMessage(id, userEmail, reaction);\r\n        } else if (content) {\r\n            result = dbSocial.editMessage(id, userEmail, content);\r\n        } else {\r\n            return NextResponse.json({ error: \"No action specified\" }, { status: 400 });\r\n        }\r\n\r\n        if (!result) return NextResponse.json({ error: \"Unauthorized or Not Found\" }, { status: 403 });\r\n\r\n        return NextResponse.json(result);\r\n    } catch (e: any) {\r\n        return NextResponse.json({ error: e.message }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe,OAAO,GAAY,EAAE,KAA0C;IACjF,IAAI;QACA,MAAM,SAAS,MAAM,MAAM,MAAM;QACjC,MAAM,EAAE,EAAE,EAAE,GAAG;QACf,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,YAAY,aAAa,GAAG,CAAC;QAEnC,IAAI,CAAC,WAAW,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;QAElF,MAAM,UAAU,mIAAQ,CAAC,aAAa,CAAC,IAAI;QAC3C,IAAI,CAAC,SAAS,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;QAE7F,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC7C,EAAE,OAAO,GAAQ;QACb,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO,EAAE,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACjE;AACJ;AAEO,eAAe,MAAM,GAAY,EAAE,KAA0C;IAChF,IAAI;QACA,MAAM,SAAS,MAAM,MAAM,MAAM;QACjC,MAAM,EAAE,EAAE,EAAE,GAAG;QACf,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG;QAEzC,IAAI;QACJ,IAAI,UAAU;YACV,SAAS,mIAAQ,CAAC,YAAY,CAAC,IAAI,WAAW;QAClD,OAAO,IAAI,SAAS;YAChB,SAAS,mIAAQ,CAAC,WAAW,CAAC,IAAI,WAAW;QACjD,OAAO;YACH,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,IAAI,CAAC,QAAQ,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;QAE5F,OAAO,4JAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,GAAQ;QACb,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO,EAAE,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACjE;AACJ"}}]
}