{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dhanush/agronova/lib/otp.ts"],"sourcesContent":["import crypto from \"crypto\";\r\n\r\nconst SECRET = process.env.OTP_SECRET || \"fallback-secret-key-change-me\";\r\n\r\nexport const generateOtp = () => {\r\n  return Math.floor(100000 + Math.random() * 900000).toString();\r\n};\r\n\r\nexport const createOtpHash = (email: string, code: string, expiry: number) => {\r\n  const data = `${email}.${code}.${expiry}`;\r\n  return crypto.createHmac(\"sha256\", SECRET).update(data).digest(\"hex\");\r\n};\r\n\r\nexport const verifyOtpHash = (email: string, code: string, expiry: number, hash: string) => {\r\n  const newHash = createOtpHash(email, code, expiry);\r\n  return newHash === hash;\r\n};\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;AAElC,MAAM,cAAc;IACzB,OAAO,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;AAC7D;AAEO,MAAM,gBAAgB,CAAC,OAAe,MAAc;IACzD,MAAM,OAAO,GAAG,MAAM,CAAC,EAAE,KAAK,CAAC,EAAE,QAAQ;IACzC,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,QAAQ,MAAM,CAAC,MAAM,MAAM,CAAC;AACjE;AAEO,MAAM,gBAAgB,CAAC,OAAe,MAAc,QAAgB;IACzE,MAAM,UAAU,cAAc,OAAO,MAAM;IAC3C,OAAO,YAAY;AACrB"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dhanush/agronova/lib/email.ts"],"sourcesContent":["import nodemailer from \"nodemailer\";\r\n\r\n// Configure the email transporter\r\n// User must provide EMAIL_USER and EMAIL_PASS in .env.local\r\nconst transporter = nodemailer.createTransport({\r\n  service: \"gmail\",\r\n  auth: {\r\n    user: process.env.EMAIL_USER,\r\n    pass: process.env.EMAIL_PASS,\r\n  },\r\n});\r\n\r\nexport const sendVerificationEmail = async (to: string, code: string) => {\r\n  if (!process.env.EMAIL_USER || !process.env.EMAIL_PASS) {\r\n    console.warn(\"⚠️  Email credentials missing. OTP will NOT be sent.\");\r\n    console.log(`[DEV MODE] OTP for ${to}: ${code}`); // Fallback for dev\r\n    return;\r\n  }\r\n\r\n  const mailOptions = {\r\n    from: `\"AgroNova Secure Login\" <${process.env.EMAIL_USER}>`,\r\n    to,\r\n    subject: `Your AgroNova Verification Code: ${code}`,\r\n    html: `\r\n      <div style=\"font-family: Arial, sans-serif; padding: 20px; color: #333;\">\r\n        <h1 style=\"color: #16a34a;\">AgroNova</h1>\r\n        <p>Hello Farmer,</p>\r\n        <p>Your secure login verification code is:</p>\r\n        <div style=\"background: #f0fdf4; border: 1px solid #16a34a; padding: 15px; text-align: center; font-size: 24px; font-weight: bold; letter-spacing: 5px; color: #16a34a; border-radius: 8px; width: fit-content;\">\r\n          ${code}\r\n        </div>\r\n        <p>This code will expire in 5 minutes.</p>\r\n        <p>If you didn't request this code, please ignore this email.</p>\r\n        <br>\r\n        <p style=\"font-size: 12px; color: #666;\">AgroNova Platform Platform © 2024</p>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  try {\r\n    await transporter.sendMail(mailOptions);\r\n    console.log(`✅  Email sent to ${to}`);\r\n  } catch (error) {\r\n    console.error(\"❌  Error sending email:\", error);\r\n    throw new Error(\"Failed to send verification email.\");\r\n  }\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,kCAAkC;AAClC,4DAA4D;AAC5D,MAAM,cAAc,wKAAU,CAAC,eAAe,CAAC;IAC7C,SAAS;IACT,MAAM;QACJ,MAAM,QAAQ,GAAG,CAAC,UAAU;QAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC9B;AACF;AAEO,MAAM,wBAAwB,OAAO,IAAY;IACtD,IAAI,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI,CAAC,QAAQ,GAAG,CAAC,UAAU,EAAE;QACtD,QAAQ,IAAI,CAAC;QACb,QAAQ,GAAG,CAAC,CAAC,mBAAmB,EAAE,GAAG,EAAE,EAAE,MAAM,GAAG,mBAAmB;QACrE;IACF;IAEA,MAAM,cAAc;QAClB,MAAM,CAAC,yBAAyB,EAAE,QAAQ,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC;QAC3D;QACA,SAAS,CAAC,iCAAiC,EAAE,MAAM;QACnD,MAAM,CAAC;;;;;;UAMD,EAAE,KAAK;;;;;;;IAOb,CAAC;IACH;IAEA,IAAI;QACF,MAAM,YAAY,QAAQ,CAAC;QAC3B,QAAQ,GAAG,CAAC,CAAC,iBAAiB,EAAE,IAAI;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM,IAAI,MAAM;IAClB;AACF"}},
    {"offset": {"line": 214, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dhanush/agronova/app/api/auth/otp/send/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { generateOtp, createOtpHash } from \"@/lib/otp\";\r\nimport { sendVerificationEmail } from \"@/lib/email\";\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const { email } = await req.json();\r\n\r\n    if (!email) {\r\n      return NextResponse.json({ error: \"Email is required\" }, { status: 400 });\r\n    }\r\n\r\n    const code = generateOtp();\r\n    const expiry = Date.now() + 5 * 60 * 1000; // 5 minutes\r\n    const hash = createOtpHash(email, code, expiry);\r\n\r\n    // Send the email (this is the real backend call)\r\n    await sendVerificationEmail(email, code);\r\n\r\n    // Return hash + expiry to client (Stateless)\r\n    // Client stores this to verify later. Code is NOT sent.\r\n    return NextResponse.json({ hash, expiry });\r\n  } catch (error: any) {\r\n    console.error(\"OTP Error:\", error);\r\n    return NextResponse.json({ error: \"Failed to send OTP\", details: error.message }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,IAAI;QAEhC,IAAI,CAAC,OAAO;YACV,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,MAAM,OAAO,IAAA,uIAAW;QACxB,MAAM,SAAS,KAAK,GAAG,KAAK,IAAI,KAAK,MAAM,YAAY;QACvD,MAAM,OAAO,IAAA,yIAAa,EAAC,OAAO,MAAM;QAExC,iDAAiD;QACjD,MAAM,IAAA,mJAAqB,EAAC,OAAO;QAEnC,6CAA6C;QAC7C,wDAAwD;QACxD,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE;YAAM;QAAO;IAC1C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAsB,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAClG;AACF"}}]
}